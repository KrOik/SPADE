# SPADE项目文件结构适配修改记录

## 修改时间
2024年当前时间戳

## 修改目的
根据项目文件结构规则，将原有的路径配置从WebPage目录结构调整为规范的data目录结构。

## 文件结构规则
- 所有.css文件应放在 `SPADE/css`
- 所有字体样式和图片应放在 `SPADE/source` 中，图片放在 `SPADE/source/img`，字体放在 `SPADE/source/tff`
- 所有.js文件应放在 `SPADE/js`
- 所有.py文件应放在 `SPADE/program`
- 所有数据文件应放在 `SPADE/data` 中：
  - 脚本生成的评分结果放在 `SPADE/data/result`
  - 产生的索引放在 `SPADE/data/index`
  - 原始数据放在 `SPADE/data/detail`
- 所有.html文件应放在 `SPADE/`
- 所有新增的测试文件应放在 `SPADE/test`
- 所有说明文件放在 `SPADE/readme`

## 修改文件清单

### 1. program/quick_start.py
**修改内容:**
- 更新 `check_system()` 函数中的数据库目录路径：从 `../WebPage/Database` 改为 `../data/detail`
- 更新输出目录路径：从 `../WebPage/result` 改为 `../data/result`
- 添加索引目录检查：`../data/index`
- 修改 `quick_process()`, `index_only()`, `score_only()` 函数的输入输出路径
- 新增 `_generate_index()` 函数：从评分结果生成统一索引文件
- 更新 `optimize_index()` 函数的文件路径，输出到 `../js/chunks`
- 更新 `create_page_cache()` 函数的缓存输出目录到 `../js/PageCache`
- 更新 `test_page_cache()` 和 `check_results()` 函数的路径

### 2. program/unified_processor.py
**修改内容:**
- 更新 batch_parser 的默认输入路径：从 `../WebPage/Database` 改为 `../data/detail`
- 更新 batch_parser 的默认输出路径：从 `../WebPage/result` 改为 `../data/result`
- 更新 index_parser 的默认输入路径：从 `../WebPage/Database` 改为 `../data/detail`
- 更新 index_parser 的默认输出文件路径：从 `peptide_index.json` 改为 `../data/index/peptide_index.json`
- 更新默认批量处理的路径参数

### 3. search.html
**修改内容:**
- 更新数据文件加载路径：从 `./database/${file}` 改为 `./data/detail/${file}`
- 索引文件路径已正确设置为 `./data/index/peptide_index.json`

### 4. program/create_chunked_index.py
**修改内容:**
- 更新 ChunkedIndexLoader 的 baseUrl：从 `./IndexJs/chunks/` 改为 `./js/chunks/`

### 5. program/README_简化操作.md
**修改内容:**
- 更新文档中的目录结构说明
- 更新命令示例中的路径
- 添加数据流程图说明

## 数据流程
```
原始数据 (data/detail/*.json)
    ↓
处理脚本 (program/*.py)
    ↓
评分结果 (data/result/scored_*.json)
    ↓
索引文件 (data/index/peptide_index.json)
    ↓
Web应用 (*.html + js/*.js)
```

## 新增功能
1. **统一索引生成**: `_generate_index()` 函数从评分结果自动生成索引文件
2. **路径自适应**: 所有脚本现在都使用符合规则的目录结构
3. **缓存优化**: 分页缓存和分块索引都输出到js目录

## 验证步骤
1. 运行 `python quick_start.py` 进行系统检查
2. 确认所有路径都能正确访问
3. 测试数据处理流程是否正常
4. 验证search.html能否正确加载数据

## 兼容性说明
- 本次修改不影响原有的数据格式
- 现有的JSON数据文件可以直接使用
- 旧的评分结果文件仍然兼容

## 注意事项
- 首次运行处理脚本时，会自动创建必要的目录结构
- 确保数据文件位于正确的 `data/detail/` 目录下
- 生成的索引和评分结果会自动分类存放

## 下一步优化建议
1. 考虑添加配置文件来管理路径设置
2. 增强错误处理和路径验证
3. 添加数据备份和恢复功能 